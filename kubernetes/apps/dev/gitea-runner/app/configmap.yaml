---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gitea-runner-config
  namespace: dev
data:
  config.yaml: |
    log:
      level: info

    runner:
      file: /data/.runner
      capacity: 2
      timeout: 3h
      insecure: false
      fetch_timeout: 5s
      fetch_interval: 2s

    cache:
      enabled: true
      dir: /data/cache

    # Use Kubernetes instead of Docker for running jobs
    container:
      backend: kubernetes
      # Default container image for jobs
      default_image: node:20-bookworm
      kubernetes:
        namespace: dev
        # Allow jobs to access K8s services (like BuildKit)
        service_account: gitea-runner-jobs
        # Mount BuildKit CLIENT certs for build jobs to connect to BuildKit daemon
        volumes:
          - name: buildkit-certs
            secret:
              secretName: buildkit-client-certs
        volume_mounts:
          - name: buildkit-certs
            mountPath: /buildkit-certs
            readOnly: true
